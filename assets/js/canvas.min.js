$(document).ready(function(){function v(){d*=e;var b=a.getObjects();for(var c in b){var f=b[c].scaleX,g=b[c].scaleY;b[c].left,b[c].top;var j=f*e,k=g*e;b[c].scaleX=j,b[c].scaleY=k,b[c].left=a.getWidth()/2-b[c].getWidth()/2,b[c].top=a.getHeight()/2-b[c].getHeight()/2,b[c].setCoords()}a.renderAll()}function w(){d/=e;var b=a.getObjects();for(var c in b){var f=b[c].scaleX,g=b[c].scaleY;b[c].left,b[c].top;var j=f*(1/e),k=g*(1/e);b[c].scaleX=j,b[c].scaleY=k,b[c].left=a.getWidth()/2-b[c].getWidth()/2,b[c].top=a.getHeight()/2-b[c].getHeight()/2,b[c].setCoords()}a.renderAll()}function B(b){fabric.util.loadImage(b,function(b){A.fill=new fabric.Pattern({source:b,repeat:"repeat"}),a.renderAll()})}function C(b){fabric.loadSVGFromURL(b,function(b,c){j=fabric.util.groupSVGElements(b,c),j.scaleToWidth(400),j.set({left:a.width/2,top:a.height/2,scaleY:(a.height-100)/j.height,scaleX:(a.width-180)/j.width}),a.add(j).centerObject(j).renderAll(),n=a.toJSON()})}function F(){$("#design-slide").css("z-index","-9999"),$(".design-prop").fadeIn().html('<img src="assets/img/web/preload.gif">'),$(".design-prop").fadeIn().html('<div style="margin-top:5px;"><h3>Artwork inspector :</h3><input type="checkbox" id="prop-fetch-layer"><label for="prop-fetch-layer">  Fetch objects</label><br><br><div class="layer-wrapper"></div></div>')}function J(b){n=a.toJSON(),$("#design-slide").css("z-index","-9999"),$(".design-prop").fadeIn().html('<img src="assets/img/web/preload.gif">'),$(".design-prop").fadeIn().html('<div style="margin-top:5px;"><p>Color : </p><input type="text" id="prop-color-group"><br><br><p>Gradient : </p><input type="text" id="prop-color-grad-1"></input><p>to : </p><input type="text" id="prop-color-grad-2"></input></div>'),$("#prop-color-group").spectrum({color:G,change:function(c){b.fill=c.toHexString(),a.renderAll()},move:function(c){b.fill=c.toHexString(),a.renderAll()}}),$("#prop-color-grad-1").spectrum({color:H,change:function(c){b.setGradient("fill",{x1:0,y1:0,x2:0,y2:b.height,colorStops:{0:c.toHexString(),1:I}}),H=c.toHexString(),a.renderAll()},move:function(c){b.setGradient("fill",{x1:0,y1:0,x2:0,y2:b.height,colorStops:{0:c.toHexString(),1:I}}),H=c.toHexString(),a.renderAll()}}),$("#prop-color-grad-2").spectrum({color:I,change:function(c){b.setGradient("fill",{x1:0,y1:0,x2:0,y2:b.height,colorStops:{0:H,1:c.toHexString()}}),I=c.toHexString(),a.renderAll()},move:function(c){b.setGradient("fill",{x1:0,y1:0,x2:0,y2:b.height,colorStops:{0:H,1:c.toHexString()}}),I=c.toHexString(),a.renderAll()}})}function M(a){$(".info").html(a),$(".info").animate({top:0},500),setTimeout(function(){$(".info").animate({top:-35})},3e3)}function N(a,b){$.post("core/action-design.php",{act:"login",a:a,b:b}).success(function(a){1==a?$(".box").animate({top:"-200"},1e3):$(".user-text").css("border","1px solid red")})}function O(a){$.post("core/action-design.php",{act:"cek_login"}).success(function(b){1==b?(o=!0,P(a)):0==b&&$(".box").animate({top:"0"},1e3)})}function P(a){switch(a){case"loadjson":Q();break;case"savejson":V();break;case"logout":R();break;case"login":$(".box").animate({top:"0"},1e3);break;case"signup":$(".box-signup").animate({top:"0"},1e3);break;case"saveImage":Z()}}function Q(){M("<img src='assets/img/web/preload-2.gif'>"),$.post("core/action-design.php",{act:"get_design",a:""}).done(function(b){a.loadFromJSON(b)})}function R(){$.post("core/action-design.php",{act:"logout"}).success(function(){o=!1,M('<label style="color:green">Success for Logout</label>')})}function S(){a.clear(),a.loadFromJSON(n),canva.renderAll()}function T(){a.loadFromJSON(n)}function U(a,b,c,d){$.post("core/action-design.php",{act:"signup",a:a,b:b,c:c,d:d}).success(function(a){1==a?(M('<label style="color:green">Sign up Success, please verify your email</label>'),$(".box-signup").animate({top:"-350"})):M('<label style="color:red">Sign up fail, please try again</label>')})}function V(){l=a.toJSON(),M("<img src='assets/img/web/preload-2.gif'>"),$.post("core/action-design.php",{act:"save_design",b:"new",c:JSON.stringify(l)}).done(function(){M("<label style='color:green'>Success saving design</label>")}).fail(function(){M("<label style='color:red'>Failed to save design</label>")})}function W(a,b){var c=/(\w+)\@(\w+)\.(\w+$|(\w+)\.(\w+$))/;a.match(c)?(b.css("border","1px solid black"),p=!0):(b.css("border","1px solid red"),p=!1)}function X(){var a=$("#username").val(),b=$("#password").val();a&&b?N(a,b):$(".user-text").filter(function(){return!this.value}).css("border","1px solid red")}function Y(){content=$(document).find("#notes-text").val(),$.post("core/action-design.php",{act:"save_note",a:content},function(a){1==a?(M('<label style="color:green">Success for saving note</label>'),$("#design-slide").hide(),$(document).find("#notes-text").val("")):0==a?M('<label style="color:red">Please, login first</label>'):(M('<label style="color:red">Fail for saving note</label>'),$(document).find("#notes-text").val(""))})}function Z(){var b=a.toDataURL();$.post("core/action-design.php",{act:"save_image",a:b},function(a){1==a&&(window.location.href="?menu=order&order=continue")})}var a=new fabric.Canvas("paper",{allowTouchScrolling:!0});new Array;var f,g,h,j,l,m,n,d=1,e=1.2,k=!1,o=!1,p=!1;if(a.on("object:selected",function(a){a.target.set({cornerColor:"black",transparentCorners:!1})}),fabric.PatternBrush){var q=new fabric.PatternBrush(a);q.getPatternSrc=function(){var a=fabric.document.createElement("canvas");a.width=a.height=10;var b=a.getContext("2d");return b.strokeStyle=this.color,b.lineWidth=5,b.beginPath(),b.moveTo(0,5),b.lineTo(10,5),b.closePath(),b.stroke(),a};var r=new fabric.PatternBrush(a);r.getPatternSrc=function(){var a=fabric.document.createElement("canvas");a.width=a.height=10;var b=a.getContext("2d");return b.strokeStyle=this.color,b.lineWidth=5,b.beginPath(),b.moveTo(5,0),b.lineTo(5,10),b.closePath(),b.stroke(),a};var s=new fabric.PatternBrush(a);s.getPatternSrc=function(){var a=10,b=2,c=fabric.document.createElement("canvas");c.width=c.height=a+b;var d=c.getContext("2d");return d.fillStyle=this.color,d.fillRect(0,0,a,a),c};var u=new fabric.PatternBrush(a);u.getPatternSrc=function(){var a=10,b=5,c=fabric.document.createElement("canvas"),d=new fabric.Rect({width:a,height:a,angle:45,fill:this.color}),e=d.getBoundingRectWidth();c.width=c.height=e+b,d.set({left:e/2,top:e/2});var f=c.getContext("2d");return d.render(f),c}}$(".t-pen").toggle(function(){a.isDrawingMode=!0,$(this).css("border-bottom","3px solid black"),$("#design-slide").css("z-index","-9999"),$(".design-prop").fadeIn().html('<img src="assets/img/web/preload.gif">'),M("You have enter Drawing Mode"),$.ajax({url:"content/property/line.php",dataType:"html"}).success(function(b){$(".design-prop").html(b),$("#property-line-color").spectrum({change:function(b){a.freeDrawingBrush.color=b.toHexString(),h=b.toHexString()}})})},function(){a.isDrawingMode=!1,$(".prop-text").hide(),$(this).css("border-bottom","1px solid white")}),$(document).on("change","#slider-line",function(){a.freeDrawingBrush.width=parseInt($(this).val(),10),g=parseInt($(this).val(),10)}),$(document).on("change","#property-line-brush",function(){val=$(this).val(),a.freeDrawingBrush="vLinePatternBrush"==val?q:"hLinePatternBrush"==val?r:"diamondPatternBrush"==val?u:"squarePatternBrush"==val?s:new fabric[val+"Brush"](a),a.freeDrawingBrush.width=g,a.freeDrawingBrush.color=h}),$(".t-all").click(function(){a.setActiveGroup(new fabric.Group(a.getObjects())).renderAll(),M("Select all objects")}),$(".t-zoom-in").click(function(){return v(),!1}),$(".t-zoom-out").click(function(){return w(),!1}),$(document).on("click",".acr-content-wrapper",function(){var b=$(this).attr("svg");return C(b),$("#design-slide").hide(),!1}),$(document).on("click",".design-artwork-image-wrapper img",function(){var b=$(this).attr("svg");return C(b),$("#design-slide").hide(),!1}),$(document).on("click",".design-artwork-image-wrapper",function(){var c=$(this).find("img").attr("src");return fabric.Image.fromURL(c,function(b){b.set({width:100,height:100,left:a.getWidth()/2,top:a.getHeight()/2+32}),a.add(b)}),$("#design-slide").hide(),!1}),$("canvas").bind("contextmenu",function(a){a.preventDefault();var b=a.offsetX,c=a.offsetY;return _t=a.target,_target=_t,_=$(this).offset(),b=_.left,c=_.top,$("#design-context-menu").fadeIn().css({top:a.pageY-c,left:a.pageX-b}),!1}),$("#text").click(function(){$("#design-slide").css("z-index","-9999"),$(".design-prop").fadeIn().html('<img src="assets/img/web/preload.gif">'),$("#design-text").fadeIn(),$.ajax({url:"content/property/text.php",dataType:"html"}).success(function(b){$(".design-prop").html(b),$("#property-text").focus(),$("#prop-color-stroke").spectrum({change:function(b){A.set({stroke:b.toHexString(),strokeWidth:1}),a.renderAll()},move:function(b){A.set({stroke:b.toHexString(),strokeWidth:1}),a.renderAll()}})})}),$(document).on("click","#prop-efect",function(){var c=fabric.document.createElement("canvas"),d="AKU";ctx=c.getContext("2d"),ctx.measureText(d).width;var f=100;c.height=f,ctx.font="20px Georgia",ctx.fillText(d,0,f/2),ctx.textBaseline="top",ctx.textAlign="center",fabric.Image.fromURL(c.toDataURL(),function(b){b.left=100,b.top=100,a.add(b),a.renderAll()})});var A=new fabric.Text("",{fontSize:40,left:a.getWidth()/2,top:a.getHeight()/2-32});$(document).on("keyup","#property-text",function(){str=$(this).val(),""==str&&(A.set({strokeWidth:0,stroke:"black",fill:"black "}),a.renderAll()),a.remove(A),A.set({text:str}),a.add(A),n=a.toJSON(),a.renderAll()}),$(document).on("change","#property-font",function(){val=$(this).val(),D.set({fontFamily:val}),a.renderAll()}),$(document).on("click","#text-pattern div",function(){val=$(this).attr("id"),B("assets/img/pattern/"+val+".jpg")}),$(document).bind("click",function(b){if($(b.target).is("#design-context-menu li"))switch(_ta=$(b.target).attr("action")){case"delete":n=a.toJSON(),act=a.getActiveObject(),act.remove(),$("#design-context-menu").fadeOut();break;case"clear":a.clear();break;case"front":act=a.getActiveObject(),act.bringToFront();break;case"back":act=a.getActiveObject(),act.sendToBack()}$("#design-context-menu").fadeOut()}),$(".color").spectrum({change:function(b){try{D.paths[0].fill=b.toHexString()}catch(c){D.fill=b.toHexString()}finally{a.renderAll()}},move:function(b){try{D.paths[0].fill=b.toHexString()}catch(c){D.fill=b.toHexString()}finally{a.renderAll()}}});var D,E=!1;$("canvas").mousedown(function(){var d,c=a.getObjects();for(i in c)1==c[i].active?(d=c[i],D=d,type=d.get("type"),"path-group"==type?E||(F(),E=!0):"text"==type?(E=!1,J(d)):(E=!1,$(".design-prop").fadeOut())):E=!1}),$(document).on("click","#prop-fetch-layer",function(){var b=D.paths;if(check=$(this).prop("checked"),console.log(D.paths[0]),check){$(".design-prop .layer-wrapper").html('<div class="object-tittle"><label>Hide</label><label>Color</label></div>');for(i in b)$(".design-prop .layer-wrapper").append('<div class="object" id="'+i+'" color="'+b[i].fill+'"><label>Object '+i+"</label>"+'<div class="object-tool"><label class="object-hide"></label><label class="object-color"></label></div>'+"</div>")}else $(".design-prop .layer-wrapper").html("")}),$(document).on("mouseover",".object",function(){var c=$(this).attr("id");D.paths[c].fill="#0BB5FF",a.renderAll()}),$(document).on("mouseleave",".object",function(){var c=$(this).attr("id"),d=$(this).attr("color");D.paths[c].fill=d,a.renderAll()}),$(document).on("click",".object-hide",function(a){a.preventDefault(),f=$(this).parents(".object").attr("id"),alert("hide"+f)}),$(document).on("click",".object-color",function(b){b.preventDefault();var c=$(this).offset().left;c=c-$(".layer-wrapper").offset().left-50;var d=$(this).offset().top;d=d-$(".layer-wrapper").offset().top+20,f=$(this).parents(".object").attr("id"),$(".layer-wrapper").append('<div class="object-tooltip"><div class="container">    <div class="content">        <div class="center">           <div style="margin-top:5px;"><p>Color : </p>           <input type="text" class="object-color"><br><br>           <p class="inline">Gradient : </p><input type="text" id="prop-color-grad-1-" class="inline"></input>           <p  class="inline">to : </p><input type="text" id="prop-color-grad-2-" class="inline"></input></div>        </div>    </div></div>'),$(".object-color").spectrum({color:target.fill,change:function(b){target.fill=b.toHexString(),a.renderAll()},move:function(b){target.fill=b.toHexString(),a.renderAll()}}),$(".object-tooltip").css({left:c,top:d})});var G="#fff",H="#fff",I="#fff";$("#color").click(function(){$("#design-slide").css({height:"325px",top:"0px"}),$("#design-slide").children(".segitiga").css({"-webkit-transform":"translate(-8px,90px)","-moz-transform":"translate(-8px,90px)"}),$("#design-slide #design-slide-content").html('<img src="assets/img/web/preload.gif">'),$("#design-slide").removeClass().addClass("animated fadeInLeft").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass(),$(this).children("#design-slide-content").load("content/nav/color.php",function(){$("#color-product").iris({width:300,hide:!1,palettes:["#125","#459","#78b","#ab0","#de3","#f0f"],change:function(a,b){j.paths[0].fill=b.color.toString()}}),$("#color-product").focus()})}).fadeIn()}),$("canvas").mouseenter(function(){k=!0}),$("canvas").mouseleave(function(){k=!1}),$(document).keydown(function(b){k&&(key=b.keyCode,8==key&&(b.preventDefault(),act=a.getActiveObject(),act.remove()))}),$(".t-export").click(function(){var c=a.toDataURL("images/png").replace("images/png","images/octet-stream");return $(this).attr({download:"mohgeo.png",href:c,target:"_blank"}),!0}),$(".t-switch").toggle(function(){$(this).css("border-bottom","3px solid black"),l=a.toJSON(),a.clear(),null==m&&C("assets/img/design/back.svg"),M("Back Side"),a.loadFromJSON(m),a.renderAll()},function(){$(this).css("border-bottom","1px solid white"),m=a.toJSON(),a.clear(),M("Front Side"),a.loadFromJSON(l),a.renderAll()}),$(".t-undo").click(function(){S()}),$(".t-redo").click(function(){T()}),$(".t-setting").toggle(function(a){_=$(this).offset(),y=_.top-170,x=18+a.pageX-_.left,$(".tooltip").hide(),$("#design-account").fadeIn().css({top:y,left:x})},function(){$("#design-account").hide()}),$("#design-account li").click(function(){$("#design-account").hide(),act=$(this).attr("action"),P(act)}),$("#signup-signup").click(function(){var b=$("#signup-first").val(),c=$("#signup-last").val(),d=$("#signup-email").val(),e=$("#signup-password").val(),f=$("#signup-re-password").val();$(".signup-text").filter(function(){return!this.value}).css("border","1px solid red"),f&&(e==f?p?U(b,c,d,e):$("#signup-email").css("border","1px solid red"):$("#signup-password,#signup-re-password").css("border","1px solid red"))}),$("#signup-cancel").click(function(){return $(".box-signup").animate({top:"-350"}),!1}),$(".t-load").click(function(){return O("loadjson"),!1}),$("#signup-email").keyup(function(){val=$(this).val(),W(val,$(this))}),$(".t-save").click(function(){return O("savejson"),!1}),$("#login-cancel").click(function(){return $(".box").animate({top:"-200"},1e3),!1}),$(".user-text, .signup-text").change(function(){$(this).css("border","1px solid black")}),$("#password").keypress(function(a){13==a.keyCode&&X()}),$("#login-login").click(function(){X()}),$("#image-file").live("change",function(){$("#loader").fadeIn().css("z-index","9999"),$("#form-image").ajaxForm({target:"#result-upload",success:function(){val=$("#design-image-upload").val(),fabric.Image.fromURL(val,function(b){b.set({top:a.getHeight()/2,left:a.getWidth()/2,width:250,height:350}),a.add(b)}),$("#loader").fadeOut().css("z-index","-99999")}}).submit(),$("#design-slide").addClass("animated fadeOutLeft").one("webkitAnimationEnd mozAnimationEnd",function(){$("#design-slide").css("z-index","-9999")})}),$(document).on("click","#notes-ok",function(){val=$(document).find("#notes-text"),val.val()?Y():(M('<label style="color:red">Fil the box</label>'),val.focus())}),$(document).on("click","#notes-no",function(){$("#design-slide").hide()}),$(".get-design img").click(function(){return $(this).parent("div").hide(),!1}),getDesign=$.cookie("get-design"),"true"==getDesign?$(".get-design").show():$(".get-design").hide(),$(".get-design").click(function(){O("saveImage")}),a.renderAll()});